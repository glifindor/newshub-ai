events {
    worker_connections 1024;
}

http {
    upstream auth {
        server auth-service:8081;
    }
    
    upstream news {
        server news-service:8082;
    }
    
    upstream seo {
        server seo-service:8093;
    }
    
    upstream media {
        server media-service:8085;
    }
    
    upstream admin {
        server admin-service:8084;
    }

    server {
        listen 80;
        
        # Auth endpoints
        location /api/v1/register {
            proxy_pass http://auth;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
        
        location /api/v1/login {
            proxy_pass http://auth;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
        
        location /api/v1/logout {
            proxy_pass http://auth;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
        
        location /api/v1/verify {
            proxy_pass http://auth;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
        
        # News endpoints
        location /api/v1/news {
            proxy_pass http://news;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
        
        location /api/v1/categories {
            proxy_pass http://news;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
        
        location /api/v1/tags {
            proxy_pass http://news;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
        
        # SEO endpoints
        location /sitemap.xml {
            proxy_pass http://seo;
            proxy_set_header Host $host;
        }
        
        location /robots.txt {
            proxy_pass http://seo;
            proxy_set_header Host $host;
        }
        
        location /api/v1/seo {
            proxy_pass http://seo;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
        
        # Media endpoints
        location /api/v1/upload {
            proxy_pass http://media;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            client_max_body_size 10M;
        }
        
        location /uploads/ {
            proxy_pass http://media;
            proxy_set_header Host $host;
        }
        
        # Admin endpoints
        location /api/admin/ {
            proxy_pass http://admin;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
        
        # Health check
        location /health {
            return 200 "OK\n";
            add_header Content-Type text/plain;
        }
    }
}
